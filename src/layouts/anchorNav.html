<nav id="side-nav" class="side-nav">
  <ul id="side-nav-list"></ul>
</nav>

<script>
  // JSON을 불러와 네비게이션 생성
  fetch("/data/sections.json")
    .then(res => res.json())
    .then(data => {
      const navList = document.getElementById("side-nav-list");

      data.sections.forEach(section => {
        const li = document.createElement("li");
        li.innerHTML = `
          <a href="#${section.id}" class="side-nav-link" data-section="${section.id}">
            <span class="icon"></span>
          </a>
        `;
        navList.appendChild(li);
      });

      setupScrollSpy();   // 네비 생성 후 스크롤스파이 활성화
    });

  // 스크롤스파이 + 부드러운 스크롤
  function setupScrollSpy() {
    const links = document.querySelectorAll(".side-nav-link");
    const sections = document.querySelectorAll("section[id]");

    // 부드러운 스크롤
    links.forEach(link => {
      link.addEventListener("click", e => {
        e.preventDefault();
        const id = link.dataset.section;
        document.getElementById(id).scrollIntoView({ behavior: "smooth" });
      });
    });

    // IntersectionObserver 로 active 업데이트
    const observer = new IntersectionObserver(
      entries => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            const id = entry.target.id;
            links.forEach(link => {
              link.classList.toggle("active", link.dataset.section === id);
            });
          }
        });
      },
      { threshold: 0.55 }
    );

    sections.forEach(sec => observer.observe(sec));
  }
</script>
